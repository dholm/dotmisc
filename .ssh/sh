ssh_config="$HOME/.ssh/config"
ssh_config_files=( "$HOME/.ssh/conf" "$HOME/.ssh/conf.local" )

function ssh_configure()
{
    local update_config=

    for file in ${ssh_config_files[@]}
    do
        if [ -r "${file}" ] && [ "${file}" -nt "${ssh_config}" ]
        then
            debug "Configuration has changed in ${file}.."
            update_config=true
        fi
    done

    if [ ${update_config} ]
    then
        debug "Updating SSH configuration.."
        cat ${ssh_config_files[@]} 1> ${ssh_config} 2>/dev/null
    fi

    return 0
}

function _ssh_setup
{
    if is_darwin
    then
        alias_add ssh 'ssh_configure; ssh'
    else
        alias_add ssh "ssh -F <(cat ${ssh_config_files} 2>/dev/null)"
    fi
}
eval_safe _ssh_setup

# Local Variables:
# mode: shell-script
# End:
